<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"><meta name="description" content="Springäº‹åŠ¡è¯¦è§£"><meta name="hexo-theme-A4" content="v1.8.9"><link rel="alternate icon" type="image/webp" href="/avatar.png"><title>mytianya | Dreamâ€™s never sold, Bloodâ€™s never cold</title><link rel="stylesheet" href="/css/highlight/style1.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/ui.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/returnToTop.css"><link rel="stylesheet" href="/css/unicons.css"><link rel="stylesheet" href="/css/toc.css"><link rel="stylesheet" href="/css/returnToLastPage.css"><link rel="stylesheet" href="/css/lightgallery.min.css"><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="mytianya" type="application/atom+xml">
</head><style>body{background-image:url(/img/leaves-pattern.png)}.paper{background-image:url(/img/leaves-pattern.png)}</style><body><div class="left-toc-container"><nav id="toc" class="bs-docs-sidebar"></nav></div><div class="paper"><div class="shadow-drop-2-bottom paper-main"><div class="header"><div class="header-container"><img style="width:56px;height:auto" alt="^-^" cache-control="max-age=86400" class="header-img" src="/avatar.png" width="10%"><div class="header-content"><a class="logo" href="/">mytianya</a> <span class="description"></span></div></div><ul class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/list/">æ–‡ç« </a></li><li><a href="/about/">å…³äº</a></li><li><a href="/tags/">æ ‡ç­¾</a></li><li><a href="/categories/">åˆ†ç±»</a></li></ul></div><div class="post-main"><div class="post-main-title">Springäº‹åŠ¡è¯¦è§£</div><div class="post-md"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7-ACID"><span class="post-toc-text">äº‹åŠ¡ç‰¹æ€§(ACID)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E6%8E%A5%E5%8F%A3"><span class="post-toc-text">Springäº‹åŠ¡ç®¡ç†æ¥å£</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#PlatformTransactionManager%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="post-toc-text">PlatformTransactionManageræ ¸å¿ƒæ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TransactionDefinition%E4%BA%8B%E5%8A%A1%E5%AE%9A%E4%B9%89"><span class="post-toc-text">TransactionDefinitionäº‹åŠ¡å®šä¹‰</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="post-toc-text">äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%94%AF%E6%8C%81%E5%A4%96%E5%B1%82%E4%BA%8B%E5%8A%A1%E6%83%85%E5%86%B5"><span class="post-toc-text">æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%96%E5%B1%82%E4%BA%8B%E5%8A%A1%E6%83%85%E5%86%B5"><span class="post-toc-text">ä¸æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E6%83%85%E5%86%B5"><span class="post-toc-text">å…¶ä»–æƒ…å†µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="post-toc-text">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span></a></li></ol></li></ol><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring%E4%BA%8B%E5%8A%A1%E9%9B%86%E6%88%90"><span class="post-toc-text">Springäº‹åŠ¡é›†æˆ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="post-toc-text">å£°æ˜å¼äº‹åŠ¡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="post-toc-text">ç¼–ç¨‹å¼äº‹åŠ¡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AOP%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1"><span class="post-toc-text">AOPå…¨å±€äº‹åŠ¡</span></a></li></ol></li><div class=".article-gallery"><blockquote><p>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p></blockquote><h2 id="äº‹åŠ¡ç‰¹æ€§-ACID"><a href="#äº‹åŠ¡ç‰¹æ€§-ACID" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§(ACID)"></a>äº‹åŠ¡ç‰¹æ€§(ACID)</h2><ul><li>Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%9B%9E%E6%BB%9A_(%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)">å›æ»š</a>ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚[<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ACID#cite_note-acid-1">1]</a></li><li>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7">çº¦æŸ</a>ã€<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%A7%A6%E5%8F%91%E5%99%A8_(%E6%95%B0%E6%8D%AE%E5%BA%93)">è§¦å‘å™¨</a>ã€<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BA%A7%E8%81%94%E5%9B%9E%E6%BB%9A">çº§è”å›æ»š</a>ç­‰ã€‚[<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ACID#cite_note-acid-1">1]</a></li><li>Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬æœªæäº¤è¯»ï¼ˆRead uncommittedï¼‰ã€æäº¤è¯»ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚[<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ACID#cite_note-acid-1">1]</a></li><li>Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul><h2 id="Springäº‹åŠ¡ç®¡ç†æ¥å£"><a href="#Springäº‹åŠ¡ç®¡ç†æ¥å£" class="headerlink" title="Springäº‹åŠ¡ç®¡ç†æ¥å£"></a>Springäº‹åŠ¡ç®¡ç†æ¥å£</h2><p>â€‹	<strong>Springå¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨</strong> ï¼Œä»–ä»¬å°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™Hibernateæˆ–è€…JTAç­‰æŒä¹…åŒ–æœºåˆ¶æ‰€æä¾›çš„ç›¸å…³å¹³å°æ¡†æ¶çš„äº‹åŠ¡æ¥å®ç°ã€‚ Springäº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ˜¯ï¼š <strong>org.springframework.transaction.PlatformTransactionManager</strong> ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpringä¸ºå„ä¸ªå¹³å°å¦‚JDBCã€Hibernateç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚</p><p><a href="/img/PlatformTransactionManager.png" title="PlatformTransactionManager" class="gallery-item" style="box-shadow:none"><img src="/img/PlatformTransactionManager.png" alt="PlatformTransactionManager"></a></p><h3 id="PlatformTransactionManageræ ¸å¿ƒæ–¹æ³•"><a href="#PlatformTransactionManageræ ¸å¿ƒæ–¹æ³•" class="headerlink" title="PlatformTransactionManageræ ¸å¿ƒæ–¹æ³•"></a>PlatformTransactionManageræ ¸å¿ƒæ–¹æ³•</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PlatformTransactionManager</span> <span class="keyword">extends</span> <span class="title class_">TransactionManager</span> {</span><br><span class="line">	<span class="comment">//æ ¹æ®æŒ‡å®šçš„ä¼ æ’­è¡Œä¸ºï¼Œè¿”å›å½“å‰æ´»åŠ¨çš„äº‹åŠ¡æˆ–åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡</span></span><br><span class="line">	TransactionStatus <span class="title function_">getTransaction</span><span class="params">(<span class="meta">@Nullable</span> TransactionDefinition definition)</span></span><br><span class="line">			<span class="keyword">throws</span> TransactionException;</span><br><span class="line">	<span class="comment">//ä½¿ç”¨äº‹åŠ¡ç›®å‰çš„çŠ¶æ€æäº¤äº‹åŠ¡</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException;</span><br><span class="line">	<span class="comment">//å¯¹æ‰§è¡Œçš„äº‹åŠ¡è¿›è¡Œå›æ»š</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="TransactionDefinitionäº‹åŠ¡å®šä¹‰"><a href="#TransactionDefinitionäº‹åŠ¡å®šä¹‰" class="headerlink" title="TransactionDefinitionäº‹åŠ¡å®šä¹‰"></a>TransactionDefinitionäº‹åŠ¡å®šä¹‰</h3><ul><li>äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</li><li>äº‹åŠ¡éš”ç¦»çº§åˆ«</li><li>äº‹åŠ¡åç§°</li><li>äº‹åŠ¡è¶…æ—¶æ—¶é—´</li><li>æ˜¯å¦ä¸º<a target="_blank" rel="noopener" href="https://blog.csdn.net/andyzhaojianhui/article/details/51984157">åªè¯»äº‹åŠ¡</a></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TransactionDefinition</span> {</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPropagationBehavior</span><span class="params">()</span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getIsolationLevel</span><span class="params">()</span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ</span></span><br><span class="line">    <span class="comment">//è¿”å›äº‹åŠ¡çš„åå­—</span></span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>ï¼›</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getTimeout</span><span class="params">()</span>;  </span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isReadOnly</span><span class="params">()</span>;</span><br><span class="line">} </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"><a href="#äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"></a>äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</h3><p>ç®€å•çš„æ¥è¯´ï¼Œå¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶,äº‹åŠ¡å¦‚ä½•åœ¨è¿™äº›æ–¹æ³•é—´ä¼ æ’­ã€‚</p><blockquote><p>ä¸¾ä¸ªæ —å­ï¼Œæ–¹æ³•Aæ˜¯ä¸€ä¸ªäº‹åŠ¡çš„æ–¹æ³•ï¼Œæ–¹æ³•Aæ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†æ–¹æ³•Bï¼Œé‚£ä¹ˆæ–¹æ³•Bæœ‰æ— äº‹åŠ¡ä»¥åŠæ–¹æ³•Bå¯¹äº‹åŠ¡çš„è¦æ±‚ä¸åŒéƒ½ä¼šå¯¹æ–¹æ³•Açš„äº‹åŠ¡å…·ä½“æ‰§è¡Œé€ æˆå½±å“ï¼ŒåŒæ—¶æ–¹æ³•Açš„äº‹åŠ¡å¯¹æ–¹æ³•Bçš„äº‹åŠ¡æ‰§è¡Œä¹Ÿæœ‰å½±å“ï¼Œè¿™ç§å½±å“å…·ä½“æ˜¯ä»€ä¹ˆå°±ç”±ä¸¤ä¸ªæ–¹æ³•æ‰€å®šä¹‰çš„äº‹åŠ¡ä¼ æ’­ç±»å‹æ‰€å†³å®šã€‚</p></blockquote><h5 id="æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ"><a href="#æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ" class="headerlink" title="æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ"></a>æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ</h5><ul><li>Required: å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼ŒåŠ å…¥å½“å‰äº‹åŠ¡ã€‚æ²¡æœ‰è‡ªå·±åˆ›å»ºæ–°ä¸€ä¸ªäº‹åŠ¡ã€‚</li><li>Supports: å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼ŒåŠ å…¥å½“å‰äº‹åŠ¡ã€‚æ²¡æœ‰è‡ªå·±ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚</li><li>Mandatory: å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼ŒåŠ å…¥å½“å‰äº‹åŠ¡ã€‚æ²¡æœ‰å½“å‰äº‹åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h4 id="ä¸æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ"><a href="#ä¸æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ" class="headerlink" title="ä¸æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ"></a>ä¸æ”¯æŒå¤–å±‚äº‹åŠ¡æƒ…å†µ</h4><ul><li>Required_NEW: åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ã€‚</li><li>Not_Supported: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ã€‚</li><li>Never: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h4 id="å…¶ä»–æƒ…å†µ"><a href="#å…¶ä»–æƒ…å†µ" class="headerlink" title="å…¶ä»–æƒ…å†µ"></a>å…¶ä»–æƒ…å†µ</h4><ul><li>Nested: å½“å‰å¤–å±‚å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªåµŒå¥—äº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œã€‚æ²¡æœ‰ç­‰äºRequiredã€‚</li></ul><h4 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h4><p>å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚</p><p><strong>TransactionDefinition.ISOLATION_DEFAULT:</strong>	ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«.</p><p><strong>TransactionDefinition.ISOLATION_READ_UNCOMMITTED:</strong> æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</strong></p><p><strong>TransactionDefinition.ISOLATION_READ_COMMITTED:</strong> å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong></p><p><strong>TransactionDefinition.ISOLATION_REPEATABLE_READ:</strong> å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</strong></p><p><strong>TransactionDefinition.ISOLATION_SERIALIZABLE:</strong> æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚</p><h2 id="Springäº‹åŠ¡é›†æˆ"><a href="#Springäº‹åŠ¡é›†æˆ" class="headerlink" title="Springäº‹åŠ¡é›†æˆ"></a>Springäº‹åŠ¡é›†æˆ</h2><h3 id="å£°æ˜å¼äº‹åŠ¡"><a href="#å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡"></a>å£°æ˜å¼äº‹åŠ¡</h3><p>é€šè¿‡åœ¨æ–¹æ³•æˆ–ç±»æˆ–æ¥å£ä¸Šæ·»åŠ æ³¨è§£è¿›è¡ŒåŒ…è£…ï¼Œæ— ä¾µå…¥åœ°å®ç°äº‹åŠ¡ï¼Œæ›´æ–¹ä¾¿ï¼Œä½†ç²’åº¦æ›´å¤§ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED,timeout = 3000,rollbackFor = Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">save</span><span class="params">(Integer id,String name)</span>{</span><br><span class="line">    String insertSql=<span class="string">"insert into `tb_user`(`id`,`name`)values(?,?);"</span>;</span><br><span class="line">    jdbcTemplate.update(insertSql,id,name);</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">"select  count(*) from tb_user"</span>,Integer.class);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="ç¼–ç¨‹å¼äº‹åŠ¡"><a href="#ç¼–ç¨‹å¼äº‹åŠ¡" class="headerlink" title="ç¼–ç¨‹å¼äº‹åŠ¡"></a>ç¼–ç¨‹å¼äº‹åŠ¡</h3><p>é€šè¿‡ç¼–ç çš„æ–¹å¼æ‰‹åŠ¨å¯ç”¨ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼Œç²’åº¦æ›´ç»†ï¼Œä½†æ›´éº»çƒ¦ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">save</span><span class="params">(Integer id,String name)</span>{</span><br><span class="line">    Integer num=transactionTemplate.&lt;Integer&gt;execute((TransactionStatus status)-&gt;{</span><br><span class="line">      <span class="keyword">try</span>{</span><br><span class="line">        String insertSql=<span class="string">"insert into `tb_user`(`id`,`name`)values(?,?);"</span>;</span><br><span class="line">        jdbcTemplate.update(insertSql,id,name);</span><br><span class="line">      }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        status.setRollbackOnly();</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">"select  count(*) from tb_user"</span>,Integer.class);</span><br><span class="line">    });</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">  }</span><br><span class="line"><span class="comment">//æˆ–è€…</span></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">save2</span><span class="params">(Integer id,String name)</span>{</span><br><span class="line">    TransactionStatus transactionStatus=transactionManager.getTransaction(<span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>());</span><br><span class="line">    <span class="keyword">try</span>{</span><br><span class="line">      String insertSql=<span class="string">"insert into `tb_user`(`id`,`name`)values(?,?);"</span>;</span><br><span class="line">      jdbcTemplate.update(insertSql,id,name);</span><br><span class="line">        transactionManager.commit(transactionStatus);</span><br><span class="line">      }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        transactionManager.rollback(transactionStatus);</span><br><span class="line">      }</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">"select  count(*) from tb_user"</span>,Integer.class);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><h3 id="AOPå…¨å±€äº‹åŠ¡"><a href="#AOPå…¨å±€äº‹åŠ¡" class="headerlink" title="AOPå…¨å±€äº‹åŠ¡"></a>AOPå…¨å±€äº‹åŠ¡</h3><p>ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç­‰å¾…å…¨å±€æ€§äº‹åŠ¡ï¼Œæ‹¦æˆªç‰¹å®šåŒ…ä¸‹é¢çš„ç‰¹å®šæ–¹æ³•ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//äº‹åŠ¡ä¾ç„¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(DataSource.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxAdviceInterceptor</span> {</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line">  <span class="meta">@Value("${tx.timeout:5}")</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">TX_METHOD_TIMEOUT</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> <span class="variable">AOP_POINTCUT_EXPRESSION</span> <span class="operator">=</span> <span class="string">"execution(* codehome.vip.*.service.*.*(..)) "</span>;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> PlatformTransactionManager transactionManager;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> TransactionInterceptor <span class="title function_">txAdvice</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">NameMatchTransactionAttributeSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NameMatchTransactionAttributeSource</span>();</span><br><span class="line">    <span class="comment">/*åªè¯»äº‹åŠ¡ï¼Œä¸åšæ›´æ–°æ“ä½œ*/</span></span><br><span class="line">    <span class="type">RuleBasedTransactionAttribute</span> <span class="variable">readOnlyTx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuleBasedTransactionAttribute</span>();</span><br><span class="line">    readOnlyTx.setReadOnly(<span class="literal">true</span>);</span><br><span class="line">    readOnlyTx.setPropagationBehavior(TransactionDefinition.PROPAGATION_NOT_SUPPORTED);</span><br><span class="line">    <span class="comment">/*å½“å‰å­˜åœ¨äº‹åŠ¡å°±ä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œå½“å‰ä¸å­˜åœ¨äº‹åŠ¡å°±åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡*/</span></span><br><span class="line">    <span class="type">RuleBasedTransactionAttribute</span> <span class="variable">requiredTx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuleBasedTransactionAttribute</span>();</span><br><span class="line">    requiredTx.setRollbackRules(</span><br><span class="line">        Collections.singletonList(<span class="keyword">new</span> <span class="title class_">RollbackRuleAttribute</span>(Exception.class)));</span><br><span class="line">    requiredTx.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);</span><br><span class="line">    requiredTx.setTimeout(TX_METHOD_TIMEOUT);</span><br><span class="line">    Map&lt;String, TransactionAttribute&gt; txMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    txMap.put(<span class="string">"save*"</span>, requiredTx);</span><br><span class="line">    txMap.put(<span class="string">"update*"</span>, requiredTx);</span><br><span class="line">    txMap.put(<span class="string">"remove*"</span>, requiredTx);</span><br><span class="line">    txMap.put(<span class="string">"*"</span>, readOnlyTx);</span><br><span class="line">    source.setNameMap(txMap);</span><br><span class="line">    <span class="type">TransactionInterceptor</span> <span class="variable">txAdvice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionInterceptor</span>(transactionManager, source);</span><br><span class="line">    <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br><span class="line">      logger.info(<span class="string">"äº‹åŠ¡ç®¡ç†å™¨å¯åŠ¨æˆåŠŸï¼"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> txAdvice;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> Advisor <span class="title function_">txAdviceAdvisor</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">AspectJExpressionPointcut</span> <span class="variable">pointcut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AspectJExpressionPointcut</span>();</span><br><span class="line">    pointcut.setExpression(AOP_POINTCUT_EXPRESSION);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultPointcutAdvisor</span>(pointcut, txAdvice());</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery){var options={selector:".gallery-item"};lightGallery(document.getElementsByClassName(".article-gallery")[0],options)}</script></div><div class="post-meta"><i><span>2023-09-25</span> <span>è¯¥ç¯‡æ–‡ç« è¢« mytianya</span> <span>æ‰“ä¸Šæ ‡ç­¾: <a href="/tags/springboot/">springboot </a></span><span>å½’ä¸ºåˆ†ç±»: <a href="/categories/java/">java</a></span></i></div><br></div><div class="footer"><span>Â© 1949-2024 China</span></div><div class="footer-last"><span>ğŸŒŠDreamâ€™s never sold, Bloodâ€™s never coldğŸŒŠ</span> <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript"></script><script src="/js/toc.js"></script><script src="/js/randomHeaderContent.js"></script><script src="/js/returnToTop.js"></script><script src="/js/returnToLastPage.js"></script><script src="/js/lightgallery.min.js"></script></div><div class="progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div><div class="return-to-last-progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div></div></body><script src="/js/darkmode-js.min.js"></script><script>function addDarkmodeWidget(){new Darkmode({bottom:"53px",right:"unset",left:"42px",time:"0.3s",mixColor:"#fff",backgroundColor:" #e4e4e4 ",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"ğŸŒ“",autoMatchOsTheme:!0}).showWidget()}window.addEventListener("load",addDarkmodeWidget)</script></html>